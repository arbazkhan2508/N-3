<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bootstrap demo</title>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet">
  <link rel="stylesheet" href="/stylesheets/allusers.css">
  <link rel="stylesheet" href="../stylesheets/swiper.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
</head>
<style>
  /* .carousel-item {
          background-color:teal;
          width:60vw;
          height: 80vh;

      } */
  .ply {
    position: relative;
    /* background-color: red; */
    padding: 5px;
  }

  .ply i {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 23px;
    color: #fff !important;
  }

  .user_det .left_btn {
    display: flex;
    align-items: center;
    gap: 20px;
    background-color: red !important;
  }

  #play {
    display: none;
  }

  #snd_on {
    display: none;
  }

  .swiper {
    width: 30%;
    height: 80%;
    /* background-color: red !important; */
  }

  .swiper .swiper-slide {
    text-align: center;
    font-size: 18px;
    background: #fff;
    display: flex !important;
    flex-direction: column !important;
    align-items: flex-start !important;
    justify-content: flex-start !important;
  }

  .swiper-slide img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
    /* display: none !important; */
  }

  .swiper-slide .img {
    display: block;
    width: 100%;
    height: 88%;
    object-fit: cover;
  }

  .user_det_1 {
    width: 100%;
    height: 12%;
    padding: initial !important;
    margin: initial !important;
    display: flex !important;
    padding-top: 20px;

    /* align-items: center;
      justify-content: space-between; */
  }

  .user_det_1 .user_info {
    /* width:fit-content;  */
    width: 50% !important;
    height: 100%;
    display: flex;
    gap: 7px;
    align-items: center;
    color: #fff;
    padding-left: 10px;
  }

  .user_det_1 .user-icon {
    width: 50%;
    height: 100%;
    display: flex;
    gap: 25px;
    align-items: center;
    justify-content: flex-end;
    color: #000 !important;
    padding-right: 10px;
  }

  .user_det_1 .user-icon i {
    color: #000;
  }

  .user_det_1 .user_info .u_picture {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    /* background-color: red; */
    overflow: hidden;
  }

  .user_det_1 .user_info .u_picture img {
    border-radius: 50%;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* swiper 2 */


  .swiper1 {
    width: 100%;
    height: 100%;
  }

  .swiper1 .swiper-slide {
    text-align: center;
    font-size: 18px;
    background: #111;
    display: flex;
    justify-content: center;
    align-items: center;
    /* background-color: rebeccapurple !important; */
  }

  .swiper-slide img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-fit: scale-down;
  }

  .swiper-slide video {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: scale-down;
    /* object-fit: cover; */
  }

  .swiper-button-prev1,
  .swiper-button-prev1 {
    position: absolute;
    top: 50%;
    background-color: teal;
    width: 40px;
    height: 40px;
    border-radius: 50%;
  }

  #storypage {
    overflow-x: hidden;
    overflow-y: hidden;
  }

  #dlt {
    text-decoration: none;
  }
</style>

<body>

  <div id="storypage">
    <div id="snav" style="background-color: #111;">
      <h6>My Instagram</h6>
      <a style="text-decoration: none;" href="/home"><i class="ri-close-fill"></i></a>
    </div>
    <div class="swiper1 mySwiper1">
      <div class="swiper-wrapper">
        <div class="swiper-slide">
          <div class="swiper mySwiper">
            <div class="swiper-wrapper">
              <% storyUser.stories.forEach(function(eachStr){ %>
                <div class="swiper-slide">
                  <div class="user_det_1">
                    <div class="user_info">
                      <div class="u_picture">
                        <img src="/getFile/<%= eachStr.owner.userProfileimg %>" alt=""></a>
                      </div>
                      <h6>
                        <%= eachStr.owner.name %>
                      </h6>
                      <h6>Time</h6>
                    </div>
                    <% if(eachStr.ext==="mp4" || eachStr.ext==="mkv" ){ %>
                      <div class="user-icon">
                        <div id="pp" class="ply">
                          <i id="snd_on" class="ri-volume-up-line"></i>
                          <i id="snd_of" class="ri-volume-mute-line"></i>
                        </div>
                        <div id="snd" class="ply">
                          <i id="pause" class="ri-pause-line"></i>
                          <i id="play" class="ri-play-fill"></i>
                        </div>
                        <h6 style="color: red;">
                          <%= user %>
                        </h6>
                        <a id="dlt" href="/deletestory/<%= eachStr._id %>"><i
                            style="font-size: 20px;color: #fff !important; " class="ri-delete-bin-7-fill"></i></a>
                      </div>
                      <% } else{ %>
                        <div class="user-icon">
                              <% if(user._id.equals(eachStr.owner._id)){ %>
                                <a id="dlt" href="/deletestory/<%= eachStr._id %>"><i
                                    style="font-size: 20px;color: #fff !important; "
                                    class="ri-delete-bin-7-fill"></i></a>
                                <% }else{ %>
                                  <i style="color: #fff;font-size: 40px; margin-right: 40px;" class="ri-more-line"></i>
                                <% } %>
                        </div>
                        <% } %>

                  </div>
                  <div class="img">
                    <% if(eachStr.ext==="mp4" || eachStr.ext==="mkv" ){ %>
                      <video id="homevideo" autoplay muted loop src="/getstory/<%= eachStr.post %>"></video>
                      <i id="pauseVideo" class="ri-play-fill" style="opacity: 1;"></i>
                      <% } else{ %>
                        <img src="/getstory/<%= eachStr.post %>" alt="">
                        <% } %>
                  </div>
                </div>
                <% }) %>
            </div>
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
            <div class="swiper-pagination"></div>
          </div>
        </div>
        <% allUsers.forEach(function(eachUser){ %>
          <% if(eachUser.stories.length===0){ %>

            <% }else{ %>
              <% if(eachUser._id.equals(storyUser._id)){ %>
                <% }else{ %>
                  <div class="swiper-slide">
                    <div class="swiper mySwiper">
                      <div class="swiper-wrapper">
                        <% eachUser.stories.forEach(function(eachStr){ %>
                          <% if(eachStr._id.equals(storyUser._id)){ %>
                            <% hello %>
                              <% }else{ %>
                                <div class="swiper-slide">
                                  <div class="user_det_1">
                                    <div class="user_info">
                                      <div class="u_picture">
                                        <img src="/getFile/<%= eachStr.owner.userProfileimg %>" alt=""></a>
                                      </div>
                                      <h6>
                                        <%= eachStr.owner.name %>
                                      </h6>
                                      <h6>Time</h6>
                                    </div>
                                    <% if(eachStr.ext==="mp4" || eachStr.ext==="mkv" ){ %>
                                      <div class="user-icon">
                                        <div id="pp" class="ply">
                                          <i id="snd_on" class="ri-volume-up-line"></i>
                                          <i id="snd_of" class="ri-volume-mute-line"></i>
                                        </div>
                                        <div id="snd" class="ply">
                                          <i id="pause" class="ri-pause-line"></i>
                                          <i id="play" class="ri-play-fill"></i>
                                        </div>
                                        <% if(user._id.equals(eachStr.owner._id)){ %>
                                          <a id="dlt" href="/deletestory/<%= eachStr._id %>"><i
                                              style="font-size: 20px;color: #fff !important; "
                                              class="ri-delete-bin-7-fill"></i></a>
                                          <% }else{ %>
                                            <i style="color: #fff;font-size: 40px; margin-right: 40px;"
                                              class="ri-more-line"></i>
                                            <% } %>
                                      </div>
                                      <% } else{ %>
                                        <div class="user-icon">
                                              <% if(user._id.equals(eachStr.owner._id)){ %>
                                                <a id="dlt" href="/deletestory/<%= eachStr._id %>"><i
                                                    style="font-size: 20px;color: #fff !important; "
                                                    class="ri-delete-bin-7-fill"></i></a>
                                                <% }else{ %>
                                                  <i style="color: #fff;font-size: 40px; margin-right: 40px;"
                                                    class="ri-more-line"></i>
                                                  <% } %>
                                        </div>
                                        <% } %>

                                  </div>
                                  <div class="img">
                                    <% if(eachStr.ext==="mp4" || eachStr.ext==="mkv" ){ %>
                                      <video id="homevideo" autoplay muted loop
                                        src="/getstory/<%= eachStr.post %>"></video>
                                      <i id="pauseVideo" class="ri-play-fill" style="opacity: 1;"></i>
                                      <% } else{ %>
                                        <img src="/getstory/<%= eachStr.post %>" alt="">
                                        <% } %>
                                  </div>
                                </div>
                                <% } %>
                                  <% }) %>
                      </div>
                      <div class="swiper-button-next"></div>
                      <div class="swiper-button-prev"></div>
                      <div class="swiper-pagination"></div>
                    </div>
                  </div>
                  <% } %>


                    <% } %>
                      <% }) %>

      </div>
      <div id="btn1" class="swiper-button-next"></div>
      <div id="btn2" class="swiper-button-prev"></div>
    </div>
  </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.3/gsap.min.js"
    integrity="sha512-gmwBmiTVER57N3jYS3LinA9eb8aHrJua5iQD7yqYCKa5x6Jjc7VDVaEA0je0Lu0bP9j7tEjV3+1qUm6loO99Kw=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.2/axios.min.js"
    integrity="sha512-NCiXRSV460cHD9ClGDrTbTaw0muWUBf/zB/yLzJavRsPNUl9ODkUVmUHsZtKu17XknhsGlmyVoJxLg/ZQQEeGA=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
    crossorigin="anonymous"></script>
  <script src="../javascripts/stories.js"></script>
</body>
<script>

  function swiperjs2() {
    var swiper1 = new Swiper(".mySwiper1", {
      // autoplay: {
      //   delay: 3000,
      //   disableOnInteraction: false,
      // },
      navigation: {
        nextEl: "#btn1",
        prevEl: "#btn2",
      },
    });
  }

  swiperjs2();

  function swiperjs1() {
    var swiper = new Swiper(".mySwiper", {
      autoplay: {
        delay: 3000,
        disableOnInteraction: false,
      },
      pagination: {
        el: ".swiper-pagination",
        type: "progressbar",
      },
      navigation: {
        nextEl: ".swiper-button-next",
        prevEl: ".swiper-button-prev",
      },
    });
  }

  swiperjs1();

  function str_sound() {
    var str_flag = 0;
    document.querySelectorAll('.swiper .swiper-slide')
      .forEach(function (sound) {
        var vids = sound.children[1].firstElementChild;
        var listn = sound.firstElementChild.children[1].firstElementChild;
        var s_on = listn.children[0];
        var s_off = listn.children[1];
        listn.addEventListener("click", function () {
          if (str_flag === 0) {
            document.querySelectorAll('video')
              .forEach(function (elm) {
                elm.muted = true;
              })
            document.querySelectorAll("#pp")
              .forEach(function (icn) {
                icn.children[0].style.display = "none";
                icn.children[1].style.display = "initial";
              })
            vids.muted = false;
            s_on.style.display = "initial";
            s_off.style.display = "none";
            str_flag = 1;
          } else {
            vids.muted = true;
            s_on.style.display = "none";
            s_off.style.display = "initial";
            str_flag = 0;
          }
        })
      })

  }

  str_sound();

  function str_pus() {
    var p_flag = 0;
    document.querySelectorAll('.swiper .swiper-slide')
      .forEach(function (pus) {
        var prnt = pus.firstElementChild.children[1];
        var listn1 = prnt.children[1];
        var vids1 = pus.children[1].firstElementChild;
        vids1.addEventListener("click", function () {
          if (p_flag === 0) {
            vids1.pause();
            prnt.children[1].children[0].style.display = "none";
            prnt.children[1].children[1].style.display = "initial";
            p_flag = 1;
            console.log(prnt.children[1].children[0]);
          } else {
            vids1.play();
            prnt.children[1].children[0].style.display = "initial";
            prnt.children[1].children[1].style.display = "none";
            p_flag = 0;
          }

        })
      })

  }

  str_pus();


</script>

</html>